<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- 1. DAFTARKAN DI CDN.ERM.DAFTAR (WAJIB!) -->
    <data noupdate="1">
        <record id="rm_surgical_safety_checklist" model="cdn.erm.daftar">
            <field name="name">Surgical Safety Checklist</field>
            <field name="no_rekam_medis">35</field>
            <field name="model_rm_id" ref="model_cdn_surgical_safety_checklist"/>
        </record>
    </data>

    <!-- 2. VIEWS -->
    <data>
        <!-- Form View -->
        <record id="view_surgical_checklist_form" model="ir.ui.view">
            <field name="name">cdn.surgical.safety.checklist.form</field>
            <field name="model">cdn.surgical.safety.checklist</field>
            <field name="inherit_id" ref="cdn_erm_base.view_form_erm_base"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">

                <header position="inside">
                        <button string="Cetak Dokumen" invisible="state == 'draft'" name="action_print_report" type="object" class="oe_highlight"/>
                </header>

                <separator name="form_title_rm" position="attributes">
                    <attribute name="string">SURGICAL SAFETY CHECKLIST</attribute>
                </separator>

                <xpath expr="//group[@name='dynamic_field']" position="inside">
                    <!-- SIGN IN -->
                    <group string="SIGN IN (Sebelum Anestesi)" colspan="2"> 
                        <field name="sign_in_verifikasi_identitas_1" widget="radio" options="{'horizontal': true}"/>
                        <field name="sign_in_tanda_operasi_1" widget="radio" options="{'horizontal': true}"/>
                        <field name="sign_in_alat_pulse_oksimetri" widget="radio" options="{'horizontal': true}"/> 
                        <field name="sign_in_riwayat_penyakit" widget="radio" options="{'horizontal': true}"/>
                        <field name="sign_in_sebutkan_riwayat_penyakit" invisible="sign_in_riwayat_penyakit != 'ya'"/>
                        <field name="sign_in_jalan_nafas" widget="radio" options="{'horizontal': true}"/>
                        <field name="sign_in_kehilangan_darah" widget="radio" options="{'horizontal': true}"/>
                    </group>

                    <!-- TIME OUT -->
                    <group string="TIME OUT (Sebelum Insisi)" colspan="2">
                        <field name="timeout_konfirmasi_anggota_tim" widget="radio" options="{'horizontal': true}"/>
                        <field name="timeout_konfirmasi_data_pasien" widget="radio" options="{'horizontal': true}"/>
                        <field name="timeout_pemberian_antibiotik" widget="radio" options="{'horizontal': true}"/>
                        <field name="timeout_keadaan_krisis" widget="radio" options="{'horizontal': true}"/>
                        <field name="timeout_sebutkan_keadaan_krisis" invisible="timeout_keadaan_krisis != 'ya'"/>
                        <field name="timeout_kehilangan_darah" widget="radio" options="{'horizontal': true}"/>
                        <field name="timeout_sebutkan_kehilangan_darah" invisible="timeout_kehilangan_darah != 'ya'"/>
                        <field name="timeout_kondisi_khusus_pasien" widget="radio" options="{'horizontal': true}"/>
                        <field name="timeout_sebutkan_kondisi_khusus_pasien" invisible="timeout_kondisi_khusus_pasien != 'ya'"/>
                        <field name="timeout_peralatan_steril" widget="radio" options="{'horizontal': true}"/>
                        <field name="timeout_sebutkan_peralatan_steril" invisible="timeout_peralatan_steril != 'ya'"/>
                        <field name="timeout_keadaan_alat" widget="radio" options="{'horizontal': true}"/>
                        <field name="timeout_sebutkan_keadaan_alat" invisible="timeout_keadaan_alat != 'ya'"/>
                        <field name="timeout_foto_pasien" widget="radio" options="{'horizontal': true}"/>
                        <field name="timeout_jml_kasa" placeholder="Jumlah Kasa"/>
                    </group>

                    <!-- SIGN OUT -->
                    <group string="SIGN OUT (Sebelum Keluar Ruang Operasi)" colspan="2">
                        <field name="signout_nama_prosedur" placeholder="Nama Prosedur"/>
                        <field name="signout_perhitungan_instrumen_1" widget="radio" options="{'horizontal': true}"/>
                        <field name="signout_jml_kasa" placeholder="Jumlah Kasa Terpakai"/>
                        <field name="signout_pemakaian_alat" widget="radio" options="{'horizontal': true}"/>
                        <field name="signout_labeling_spesimen" widget="radio" options="{'horizontal': true}"/>
                        <field name="signout_masalah_peralatan" widget="radio" options="{'horizontal': true}"/>
                        <field name="signout_sebutkan_masalah_peralatan" invisible="signout_masalah_peralatan != 'ya'"/>
                        <field name="signout_anestesis_peralatan" widget="radio" options="{'horizontal': true}"/>
                        <field name="signout_sebutkan_masalah_anestesi" invisible="signout_anestesis_peralatan != 'ya'"/>
                    </group>


                    <!-- STATUS -->
                    <group string="Tracking">
                        <field name="status_checklist" readonly="1"/>
                        <field name="sign_in_time"/>
                        <field name="time_out_time"/>
                        <field name="sign_out_time"/>
                    </group>
                </xpath>

                <xpath expr="//group[@name='dynamic_field']" position="after">
                    <group string="Tanda Tangan dan Petugas">
                        <div style="display: flex; justify-content: space-around; text-align: center;">
                                

                                <!-- ==================== PERAWAT SIRKULASI SIGN IN ==================== -->
                                <div class="row justify-content-center text-center">
                                    <div name="wrapper_ttd_perawat" class="text-center" style="display: flex; flex-direction: column; align-items: center;">
                                        <label for="qr_ttd_perawat_sirkulasi_sign_in_id" string="Perawat Sirkulasi Sign In" style="display: flex; justify-content: center; align-items: center;"/>

                                            <div name="qr_ttd_perawat_sirkulasi_sign_in_id">
                                                <field name="qr_ttd_perawat_sirkulasi_sign_in_id" invisible="not qr_ttd_perawat_sirkulasi_sign_in_id" readonly="1" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_perawat_sirkulasi_sign_in_date" invisible="not qr_ttd_perawat_sirkulasi_sign_in_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_perawat_sirkulasi_sign_in_code" widget="image" style="width: 150px; height: 150px; object-fit: contain;" invisible="not qr_ttd_perawat_sirkulasi_sign_in_id" />
                                                <field name="qr_ttd_perawat_sirkulasi_sign_in_partner_id" invisible="not qr_ttd_perawat_sirkulasi_sign_in_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <button name="signature_generate" string="Tanda Tangani" type="object" class="oe_highlight mt-2" context="{
                                                            'tipe_nakes'    : 'Perawat',
                                                            'field_name'    : 'qr_ttd_perawat_sirkulasi_sign_in_id',
                                                            'dokumen'       : 'Surgical Safety Checklist',
                                                            'perihal'       : 'Tanda tangan Perawat Sirkulasi pada Tahap Sign In'
                                                            }" invisible="qr_ttd_perawat_sirkulasi_sign_in_id" />
                                                <button name="signature_delete" string="Hapus Tanda Tangan" type="object" class="oe_highlight mt-2" 
                                                        invisible="not qr_ttd_perawat_sirkulasi_sign_in_id" 
                                                        context="{
                                                            'model'         :'cdn.surgical.safety.checklist',
                                                            'field_name'    :'qr_ttd_perawat_sirkulasi_sign_in_id',
                                                            'data_id'       :id,
                                                            'this_data'     :False
                                                            }"/>
                                        </div>
                                    </div>
                                </div>


                                <!-- ==================== PERAWAT SIRKULASI TIME OUT ==================== -->
                                <div class="row justify-content-center text-center">
                                    <div name="wrapper_ttd_perawat" class="text-center" style="display: flex; flex-direction: column; align-items: center;">
                                        <label for="qr_ttd_perawat_sirkulasi_time_out_id" string="Perawat Sirkulasi Time Out" style="display: flex; justify-content: center; align-items: center;"/>

                                            <div name="qr_ttd_perawat_sirkulasi_time_out_id">
                                                <field name="qr_ttd_perawat_sirkulasi_time_out_id" invisible="not qr_ttd_perawat_sirkulasi_time_out_id" readonly="1" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_perawat_sirkulasi_time_out_date" invisible="not qr_ttd_perawat_sirkulasi_time_out_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_perawat_sirkulasi_time_out_code" widget="image" style="width: 150px; height: 150px; object-fit: contain;" invisible="not qr_ttd_perawat_sirkulasi_time_out_id" />
                                                <field name="qr_ttd_perawat_sirkulasi_time_out_partner_id" invisible="not qr_ttd_perawat_sirkulasi_time_out_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <button name="signature_generate" string="Tanda Tangani" type="object" class="oe_highlight mt-2" context="{
                                                            'tipe_nakes'    : 'Perawat',
                                                            'field_name'    : 'qr_ttd_perawat_sirkulasi_time_out_id',
                                                            'dokumen'       : 'Surgical Safety Checklist',
                                                            'perihal'       : 'Tanda tangan Perawat Sirkulasi pada Tahap Time Out'
                                                            }" invisible="qr_ttd_perawat_sirkulasi_time_out_id"/>
                                                <button name="signature_delete" string="Hapus Tanda Tangan" type="object" class="oe_highlight mt-2" 
                                                        invisible="not qr_ttd_perawat_sirkulasi_time_out_id" 
                                                        context="{
                                                            'model'         :'cdn.surgical.safety.checklist',
                                                            'field_name'    :'qr_ttd_perawat_sirkulasi_time_out_id',
                                                            'data_id'       :id,
                                                            'this_data'     :False
                                                            }"/>
                                        </div>
                                    </div>
                                </div>
                        

                                <!-- ==================== DOKTER BEDAH SIGN OUT ==================== -->
                                <div class="row justify-content-center text-center">
                                    <div name="wrapper_ttd_bedah" class="text-center" style="display: flex; flex-direction: column; align-items: center;">
                                        <label for="qr_ttd_dokter_bedah_id" string="Dokter Bedah Sign Out" style="display: flex; justify-content: center; align-items: center;"/>

                                            <div name="qr_ttd_dokter_bedah_id">
                                                <field name="qr_ttd_dokter_bedah_id" readonly="1" invisible="not qr_ttd_dokter_bedah_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_dokter_bedah_date" invisible="not qr_ttd_dokter_bedah_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_dokter_bedah_code" style="width: 150px; height: 150px; object-fit: contain;" widget="image" invisible="not qr_ttd_dokter_bedah_id" />
                                                <field name="qr_ttd_dokter_bedah_partner_id" invisible="not qr_ttd_dokter_bedah_id" style="display: flex; justify-content: center; align-items: center;"/>

                                                <button name="signature_generate" string="Tanda Tangani" type="object" class="oe_highlight mt-2" context="{
                                                            'tipe_nakes'    : 'Dokter', 
                                                            'field_name'    : 'qr_ttd_dokter_bedah_id',
                                                            'dokumen'       : 'Surgical Safety Checklist',
                                                            'perihal'       : 'Tanda tangan Dokter Bedah pada Tahap Sign Out'
                                                            }" invisible="qr_ttd_dokter_bedah_id" />
                                                <button name="signature_delete" string="Hapus Tanda Tangan" type="object" class="oe_highlight mt-2" 
                                                        invisible="not qr_ttd_dokter_bedah_id" 
                                                        context="{
                                                            'model'         :'cdn.surgical.safety.checklist',
                                                            'field_name'    :'qr_ttd_dokter_bedah_id',
                                                            'data_id'       :id,
                                                            'this_data'     :False
                                                            }"/>
                                        </div>
                                    </div>
                                </div>
                        

                                <!-- ==================== DOKTER ANESTESI SIGN OUT ==================== -->
                                <div class="row justify-content-center text-center">
                                    <div name="wrapper_ttd_anestesi" class="text-center" style="display: flex; flex-direction: column; align-items: center;">
                                        <label for="qr_ttd_dokter_anestesi_id" string="Dokter Anestesi Sign Out" style="display: flex; justify-content: center; align-items: center;"/> 

                                            <div name="qr_ttd_dokter_anestesi_id">
                                                <field name="qr_ttd_dokter_anestesi_id" readonly="1" invisible="not qr_ttd_dokter_anestesi_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_dokter_anestesi_date" invisible="not qr_ttd_dokter_anestesi_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_dokter_anestesi_code" style="width: 150px; height: 150px; object-fit: contain;" widget="image" invisible="not qr_ttd_dokter_anestesi_id" />
                                                <field name="qr_ttd_dokter_anestesi_partner_id" invisible="not qr_ttd_dokter_anestesi_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <button name="signature_generate" string="Tanda Tangani" type="object" class="oe_highlight mt-2" context="{
                                                            'tipe_nakes'    : 'Dokter', 
                                                            'field_name'    : 'qr_ttd_dokter_anestesi_id',
                                                            'dokumen'       : 'Surgical Safety Checklist',
                                                            'perihal'       : 'Tanda tangan Dokter Anestesi pada Tahap Sign Out'
                                                        }" invisible="qr_ttd_dokter_anestesi_id" />
                                                <button name="signature_delete" string="Hapus Tanda Tangan" type="object" class="oe_highlight mt-2" 
                                                        invisible="not qr_ttd_dokter_anestesi_id" 
                                                        context="{
                                                            'model'         :'cdn.surgical.safety.checklist',
                                                            'field_name'    :'qr_ttd_dokter_anestesi_id',
                                                            'data_id'       :id,
                                                            'this_data'     :False
                                                            }"/>
                                        </div>
                                    </div>
                                </div>


                                <!-- ==================== PERAWAT SIRKULASI SIGN OUT ==================== -->
                                <div class="row justify-content-center text-center">
                                    <div name="wrapper_ttd_perawat" class="text-center" style="display: flex; flex-direction: column; align-items: center;">
                                        <label for="qr_ttd_perawat_sirkulasi_sign_out_id" string="Perawat Sirkulasi Sign Out" style="display: flex; justify-content: center; align-items: center;"/>

                                            <div name="qr_ttd_perawat_sirkulasi_sign_out_id">
                                                <field name="qr_ttd_perawat_sirkulasi_sign_out_id" invisible="not qr_ttd_perawat_sirkulasi_sign_out_id" readonly="1" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_perawat_sirkulasi_sign_out_date" invisible="not qr_ttd_perawat_sirkulasi_sign_out_id" style="display: flex; justify-content: center; align-items: center;"/>
                                                <field name="qr_ttd_perawat_sirkulasi_sign_out_code" widget="image" style="width: 150px; height: 150px; object-fit: contain;" invisible="not qr_ttd_perawat_sirkulasi_sign_out_id" />
                                                <field name="qr_ttd_perawat_sirkulasi_sign_out_partner_id" invisible="not qr_ttd_perawat_sirkulasi_sign_out_id" style="display: flex; justify-content: center; align-items: center;"/>

                                                <button name="signature_generate" string="Tanda Tangani" type="object" class="oe_highlight mt-2" context="{
                                                            'tipe_nakes'    : 'Perawat',
                                                            'field_name'    : 'qr_ttd_perawat_sirkulasi_sign_out_id',
                                                            'dokumen'       : 'Surgical Safety Checklist',
                                                            'perihal'       : 'Tanda tangan Perawat Sirkulasi pada Tahap Sign Out'
                                                            }" invisible="qr_ttd_perawat_sirkulasi_sign_out_id" />
                                                <button name="signature_delete" string="Hapus Tanda Tangan" type="object" class="oe_highlight mt-2" 
                                                        invisible="not qr_ttd_perawat_sirkulasi_sign_out_id" 
                                                        context="{
                                                            'model'         :'cdn.surgical.safety.checklist',
                                                            'field_name'    :'qr_ttd_perawat_sirkulasi_sign_out_id',
                                                            'data_id'       :id,
                                                            'this_data'     :False
                                                            }"/>
                                        </div>
                                    </div>
                                </div>


                        </div>
                    </group>
                </xpath>
            </field>
        </record>

        <!-- List View -->
        <!-- <record id="view_surgical_checklist_list" model="ir.ui.view">
            <field name="name">cdn.surgical.safety.checklist.list</field>
            <field name="model">cdn.surgical.safety.checklist</field>
            <field name="arch" type="xml">
                <list>
                    <field name="patient_name"/>
                    <field name="patient_no_rm"/>
                    <field name="patient_jadwal_operasi"/>
                    <field name="status_checklist"/>
                </list>
            </field>
        </record> -->

        <!-- Search View -->
        <record id="view_surgical_checklist_search" model="ir.ui.view">
            <field name="name">cdn.surgical.safety.checklist.search</field>
            <field name="model">cdn.surgical.safety.checklist</field>
            <field name="arch" type="xml">
                <search>
                    <!-- <field name="patient_name" string="Nama Pasien"/>
                    <field name="patient_no_rm" string="No. RM"/> -->
                    <separator/>
                    <filter name="status_draft" string="Draft" domain="[('status_checklist', '=', 'draft')]"/>
                    <filter name="status_in_progress" string="Dalam Proses" domain="[('status_checklist', '=', 'in_progress')]"/>
                    <filter name="status_done" string="Selesai" domain="[('status_checklist', '=', 'done')]"/>
                    <separator/>
                    <group expand="0" string="Group By">
                        <filter name="group_by_status" string="Status" context="{'group_by': 'status_checklist'}"/>
                    </group>
                </search>
            </field>
        </record>

    </data>
</odoo>
