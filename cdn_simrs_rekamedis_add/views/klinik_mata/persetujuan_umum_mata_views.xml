<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- 1. DAFTARKAN DI CDN.ERM.DAFTAR (WAJIB!) -->
    <data noupdate="1">
        <record id="rm_persetujuan_umum" model="cdn.erm.daftar">
            <field name="name">Persetujuan Umum / General Consent mata</field>
            <field name="no_rekam_medis">9</field>
            <field name="model_rm_id" ref="model_cdn_persetujuan_umum"/>
        </record>
    </data>

    <!-- 2. INHERIT VIEW DARI CDN.ERM.BASE -->
    <data>

        <!-- res.company inherit form view -->
        <record id="res_company_for_general_consent" model="ir.ui.view">
            <field name="name">res.company.inherit.view.form</field>
            <field name="model">res.company</field>
            <field name="inherit_id" ref="cdn_erm_base.res_company_for_erm"/>
            <field name="arch" type="xml">
                <!-- Add your xpath here -->
                <page name="erm" position="inside">
                    <group name="general_consent" string="GENERAL CONSENT">
                        <field name="html_content_pernyataan_persetujuan"/>
                        <field name="html_content_pernyataan_akhir"/>
                    </group>
                </page>
            </field>
        </record>

        
        <record id="view_persetujuan_umum_form" model="ir.ui.view">
            <field name="name">cdn.persetujuan.umum.form</field>
            <field name="model">cdn.persetujuan.umum</field>
            <field name="inherit_id" ref="cdn_erm_base.view_form_erm_base"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
                <!-- Ganti judul form -->
                <separator name="form_title_rm" position="attributes">
                    <attribute name="string">PERSETUJUAN UMUM / GENERAL CONSENT</attribute>
                </separator>

                <header position="inside">
                    <button string="Print Report" invisible="state != 'done'" name="action_print" type="object" class="oe_highlight"/>
                    <!-- <button string="tesss" name="tesss" type="object" class="oe_highlight"/> -->
                </header>
                <xpath expr="//sheet" position="after">
                    <chatter reload_on_follower="True"/>
                    
                </xpath>

                <!-- Tambahkan field di dalam dynamic_field -->
                <xpath expr="//group[@name='dynamic_field']" position="after">
                    <group string="Yang bertanda tangan di bawah ini:">
                        <!-- <div class="o_form_label">
                            Yang bertanda tangan di bawah ini:
                        </div> -->

                    </group>
                    <field name="erm_properties"/>
                    <!-- <field name="general_consent_properties"/> -->
                    

                    <!-- <group>
                            <field name="nama_penanda_tangan"/>
                    </group> -->

                     <group string="PERNYATAAN PERSETUJUAN">
                        <field name="html_content_pernyataan_persetujuan" nolabel="1" readonly="1" force_save="1"/>
                    </group>

                    <group string="PERNYATAAN AKHIR">
                        <field name="html_content_pernyataan_akhir" nolabel="1" readonly="1" force_save="1"/>
                    </group>
                    <separator string="TANDA TANGAN"/>
                    <group>
                        <group string="Nama Pasien/Penanggung Jawab">
                            <field name="ttd_pasien_penanggung_jawab" widget="signature" options="{'show_name': True}"/>
                            <field name="nama_pasien_penanggung_jawab" />
                            
                        </group>
                        <group string="Pemberi Informasi">
                            
                        
                            <label for="qr_ttd_informan_id" string="TTD Pemberi Informasi"/>

                            <div name="qr_ttd_informan_id">
                                <field name="qr_ttd_informan_id" readonly="1" invisible="not qr_ttd_informan_id" />
                                <field name="qr_ttd_informan_date" invisible="not qr_ttd_informan_id" />
                                <field name="qr_ttd_informan_code" style="width: 150px; height: 150px; object-fit: contain;" widget="image"  invisible="not qr_ttd_informan_id"
                                    />
                                <field name="qr_ttd_informan_partner_id" invisible="not qr_ttd_informan_id" />

                                <button name="signature_generate"
                                        string="Tanda Tangani"
                                        type="object"
                                        class="oe_highlight mt-2"
                                        context="{
                                            'tipe_nakes'    : 'Pemberi Informasi', 
                                            'field_name'    : 'qr_ttd_informan_id',
                                            'dokumen'       : 'RM Inform Consent',
                                            'perihal'       : 'Tanda tangan pernyataan tindakan medis pada RM Inform Consent'
                                            }"
                                        invisible="qr_ttd_informan_id"
                                        />
                                <button name="signature_delete" string="Hapus Tanda Tangan" type="object" class="oe_highlight mt-2" 
                                        invisible="not qr_ttd_informan_id" 
                                        context="{
                                            'model'     :'cdn.persetujuan.umum',
                                            'field_name':'qr_ttd_informan_id',
                                            'data_id'   :id,
                                            'this_data' :False
                                            }"/>
                            </div>
                        </group>
                    
                        
                    </group>
                    
                </xpath>
            </field>
        </record>
    </data>

</odoo>
